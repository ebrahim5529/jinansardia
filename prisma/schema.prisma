generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum AccountType {
  HOSPITAL
  FACTORY
}

enum HospitalType {
  GOVERNMENT
  PRIVATE
  CHARITY
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?

  passwordHash  String?
  accountType   AccountType?

  accounts      Account[]
  sessions      Session[]

  factory       Factory?
  hospital      Hospital?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Factory {
  id                 String   @id @default(cuid())
  userId             String   @unique

  factoryName        String
  tradeName          String?
  commercialRegNo    String
  taxNo              String
  activityType       String
  country            String
  city               String
  address            String

  contactPersonName  String
  jobTitle           String
  phone              String
  altPhone           String?
  officialEmail      String
  website            String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Hospital {
  id                   String       @id @default(cuid())
  userId               String       @unique

  hospitalName         String
  facilityType         HospitalType
  healthLicenseNo      String
  supervisingAuthority String
  country              String
  city                 String
  address              String

  purchasingManagerName String
  jobTitle             String
  phone                String
  altPhone             String?
  officialEmail        String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String
  message   String   @db.Text
  status    String   @default("pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WebsiteSettings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String   @db.Text
  updatedAt DateTime @updatedAt
  updatedBy String?
}

model Country {
  id         String      @id @default(cuid())
  name       String      @unique
  code       String?     @unique
  createdAt  DateTime    @default(now())
  warehouses Warehouse[]
}

model Product {
  id           String           @id @default(cuid())
  name         String
  category     String?
  price        Float            @default(0)
  description  String?          @db.Text
  status       String           @default("active")
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  stocks       WarehouseStock[]
  certificates Certificate[]
}

model Certificate {
  id        String   @id @default(cuid())
  productId String
  type      String
  fileUrl   String   @db.Text
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model Warehouse {
  id        String           @id @default(cuid())
  name      String
  location  String?
  countryId String
  country   Country          @relation(fields: [countryId], references: [id], onDelete: Cascade)
  createdAt DateTime         @default(now())
  stocks    WarehouseStock[]
}

model WarehouseStock {
  id          String    @id @default(cuid())
  warehouseId String
  productId   String
  quantity    Int       @default(0)
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  updatedAt   DateTime  @updatedAt

  @@unique([warehouseId, productId])
}
